5.1运输层协议概述
5.1.1进程间的通信
运输层向它上面的应用层提供通信服务，它属于面向通信部分的最高层
通信的真正端点并不是主机而是主机中的进程
也就是说端到端的通信时应用进程之间的通信
当运输层采用TCP协议时 尽管下面的网络时不可靠的 但这种逻辑通信信道就相当于一条全双工的可靠信道
当运输层采用UDP协议时 通信信道时一条不可靠信道
 UDP用户数据报协议 
 TCP 传输控制协议 
 ![[截屏2022-05-18 17.35.34.png]]
 在协议栈层间的抽象的协议端口是软件端口
 和路由器或交换机上的硬件端口是不同的概念 
 硬件的端口是不同硬件设备进行交互 
 软件端口应用层的各个协议进程与运输实体进行层间交互的一种地址
 服务端使用的端口号
 ![[截屏2022-05-18 18.23.14.png]]

5.2.1 用户数据报协议
UDP是无连接的 尽最大努力交付 面向报文 没有拥塞控制
UDP支持一对一 一对多 多对一 多对多的交互通信 首部开销很小 8 字节
基本原理 差错检测 重传 累计确认 定时器 
首部格式 
源端口+目的端口+长度+检验和
5.3 TCP 概述
TCP把连接作为最基本的抽象 TCP的许多特性都与TCP是面向连接的这个基本特性有关
每一条TCP连接有两个端点 TCP连接的端点叫做套接字或插口 端口号拼接到IP地址即构成了套接字
同一个IP地址可以有多个不同的TCP连接 
同一个端口号也可以出现多个不同的TCP连接
5.4 可靠的传输的工作原理

5.4.1 停止等待协议
全双工通信的双方即是发送方也是接收方
确认和重传机制 可以保证在不可靠的传输网络上实现可靠的通信 上述这种可靠的传输协议常称为自动重传请求
5.4.2 连续ARQ 协议
滑动窗口协议 ![[截屏2022-05-19 14.35.16.png]]

5.5 TCP 报文段的首部格式
TCP报文段首部时20个字节固定
1源端口 目的端口 各占2个字节
2序号字段 占4个字节
3确认号字段 占4个字节
4数据偏移 占4位
5保留 占6位
6紧急URG 
7确认 ACK ACK=1时确认号字段才有效
8推送PSH 键入一个命令后立即就能狗收到对方的响应
9复位RST =1时表明连接中出现严重差错 必须释放连接 然后重新建立运输连接 
10同步SYN 在连接建立时来同步序号 当SYN = 1而ACK = 0 表明一个连接请求报文段 对方若同意建立连接 则应在响应的报文段中使SYN=1 ACK=1 
SYN=1表示一个连接请求或连接接收报文

11终止 FIN=1时 表明此报文段的发送方的数据已经发送完毕 要求释放运输连接
12窗口 占2字节 窗口值作为接收方让发送发设置其发送窗口的依据
13检验和 占2字节
14紧急指针 占2字节 URG=1 紧急指针指出紧急数据的末尾报文段中的位置  当所有紧急数据都处理完 TCP就告诉应用程序恢复到正常操作
15选项 长度可变 最长可达40字节 
TCP可靠传输的实现
1以字节为单位的滑动窗口 发送窗口的位置由窗口前沿和后沿的位置共同确定 发送窗口后沿变化情况有2种
1 不动 没有收到新的确认
2 前移 收到了新的确认
3窗口不能向后移动 因为不能撤销掉已经收到的确认
发送窗口前沿是不断向前移动 

2超时重传时间![[截屏2022-05-19 15.57.19.png]]的选择
3 选择确认SACK


停止等待协议能够在不可靠的传输网络上实现可靠的通信
每发送完一个分组就停止发送 等待对方的确认
收到确认后再发送下一个分组 分组需要进行编号
超时重传是指只要超过了一段时间仍然没有收到确认 就重传前面发送过的分组 因此每发送发个分组需要设置一个超时计时 其重传时间应比数据在分组传输的平均往返时间更长一些
这种自动重传方式常称为自动重传请求ARQ
在停止等待协议中 若接收方收到重复分组 就丢弃该分组 但同时还要发送确认 
连续ARQ协议可以提高信道复用率 发送方维持一个发送窗口 凡位于发送窗口内的分组都可连续发送出去 而不需要等待对方的确认
TCP使用滑动窗口机制 发送窗口里面的序号表示允许发送的序号 



